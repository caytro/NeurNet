#include "Perceptron.hpp"
#include "DataSample.hpp"
#include "DataSet.hpp"

#include <stdlib.h>
#include <numeric>
#include <cmath>
#include <cassert>
#include <algorithm>

using namespace std;

// Constructor

Perceptron::Perceptron(double biais): m_biais(biais)
{}

// Setters

void Perceptron::addInput(Perceptron& input, double weight) {
    m_dendrites.emplace_back(input, weight);
}

// Getters


const vector<Dendrite>& Perceptron::getDendrites() const
{
    return m_dendrites;
}



// Others

const double Perceptron::calcInput(const DataSample &datasample) const
{
    assert(datasample.getInput().size() == m_dendrites.size());
    vector<double> input = datasample.getInput();
    return inner_product(
        input.begin(),
        input.end(),
        m_dendrites.begin(),
        m_biais,
        plus<double>(),
        [](double in, const Dendrite& d) { return in * d.getWeight(); } );
}



void Perceptron::compute(const DataSample& datasample) {
    if (size(m_dendrites) > 0) // Sinon c'est un neurone d'entr√©e, il ne faut pas modifier m_output
    {
        z = calcInput(const  &datasample);
        m_output = activation(z));
    }
}

double Perceptron::activation(double z) const {
    return 1/(1 + exp(-z));
}

double Perceptron::calcLogLoss(const DataSet &dataSet) const
{
    return 0;
}

double Perceptron::calcGradient(const DataSet &dataSet) const
{
    return 0;
}


double Perceptron::getOutput() const {
    return m_output;
}


